{"version":3,"file":"leaflet-event-forwarder.js","sources":["../src/L.EventForwarder.js"],"sourcesContent":["import L from 'leaflet';\n\nlet _options;\nlet _container;\nlet _prevTarget = null;\n\nconst EventForwarder = L.Class.extend({\n\n\tinitialize: function (options) {\n\t\t_options = options;\n\t},\n\n\tenable: function() {\n\t\t_container = document.getElementsByClassName(`leaflet-${_options.containerName}-pane`)[0];\n\t\tif (_options.events.click === true) L.DomEvent.on(_options.map, 'click', this._handleClick, this);\n\t\tif (_options.events.mousemove === true) {\n\t\t\tL.DomEvent.on(_options.map, 'mousemove', this._throttle(this._handleMouseMove, _options.throttleMs, _options.throttleOptions), this);\n\t\t}\n\t},\n\n\tdisable: function() {\n\t\tL.DomEvent.off(_options.map, 'click', this._handleClick, this);\n\t},\n\n\t_handleMouseMove: function(event) {\n\n\t\tif (event.originalEvent._stopped) { return; }\n\n\t\t// get the target pane\n\t\tvar currentTarget = event.originalEvent.target;\n\t\tvar stopped;\n\t\tvar removed;\n\n\t\t// hide the target node\n\t\tremoved = { node: currentTarget, pointerEvents: currentTarget.style.pointerEvents };\n\t\tcurrentTarget.style.pointerEvents = 'none';\n\n\t\t// attempt to grab the next layer below\n\t\tconst nextTarget = document.elementFromPoint(event.originalEvent.clientX, event.originalEvent.clientY);\n\t\tconst isCanvas = nextTarget.nodeName.toLowerCase() === 'canvas';\n\n\t\t// mouseout previous\n\t\tif (_prevTarget && _prevTarget != nextTarget) {\n\t\t\t_prevTarget.dispatchEvent(new MouseEvent('mouseout', event.originalEvent));\n\t\t}\n\t\t_prevTarget = nextTarget;\n\n\t\t// we keep drilling down until we get stopped,\n\t\t// or we reach the map container itself\n\t\tif (\n\t\t\tnextTarget &&\n\t\t\tnextTarget.nodeName.toLowerCase() !== 'body' &&\n\t\t\tnextTarget.classList.value.indexOf('leaflet-container') === -1\n\t\t) {\n\t\t\tlet eventType = isCanvas ? 'mousemove' : 'mouseover';\n\t\t\tvar ev = new MouseEvent(eventType, event.originalEvent);\n\t\t\tstopped = !nextTarget.dispatchEvent(ev);\n\t\t\tif (stopped || ev._stopped) {\n\t\t\t\tL.DomEvent.stop(event);\n\t\t\t}\n\t\t}\n\n\t\t// restore pointerEvents\n\t\tremoved.node.style.pointerEvents = removed.pointerEvents;\n\t},\n\n\t_handleClick: function(event) {\n\n\t\tif (event.originalEvent._stopped) { return; }\n\n\t\t// get the target pane\n\t\tvar currentTarget = event.originalEvent.target;\n\t\tvar stopped;\n\t\tvar removed;\n\n\t\t// hide the target node\n\t\tremoved = { node: currentTarget, pointerEvents: currentTarget.style.pointerEvents };\n\t\tcurrentTarget.style.pointerEvents = 'none';\n\n\t\t// attempt to grab the next layer below\n\t\tlet nextTarget = document.elementFromPoint(event.originalEvent.clientX, event.originalEvent.clientY);\n\n\t\t// we keep drilling down until we get stopped,\n\t\t// or we reach the map container itself\n\t\tif (\n\t\t\tnextTarget &&\n\t\t\tnextTarget.nodeName.toLowerCase() !== 'body' &&\n\t\t\tnextTarget.classList.value.indexOf('leaflet-container') === -1\n\t\t) {\n\t\t\tvar ev = new MouseEvent(event.originalEvent.type, event.originalEvent);\n\t\t\tstopped = !nextTarget.dispatchEvent(ev);\n\t\t\tif (stopped || ev._stopped) {\n\t\t\t\tL.DomEvent.stop(event);\n\t\t\t}\n\t\t}\n\n\t\t// restore pointerEvents\n\t\tremoved.node.style.pointerEvents = removed.pointerEvents;\n\t},\n\n\t/**\n\t * Pinched from underscore\n\t * @param func\n\t * @param wait\n\t * @param options\n\t * @returns {Function}\n\t * @private\n\t */\n\t_throttle: function (func, wait, options) {\n\t\tvar context, args, result;\n\t\tvar timeout = null;\n\t\tvar previous = 0;\n\t\tif (!options) options = {};\n\t\tvar later = function() {\n\t\t\tprevious = options.leading === false ? 0 : Date.now();\n\t\t\ttimeout = null;\n\t\t\tresult = func.apply(context, args);\n\t\t\tif (!timeout) context = args = null;\n\t\t};\n\t\treturn function() {\n\t\t\tvar now = Date.now();\n\t\t\tif (!previous && options.leading === false) previous = now;\n\t\t\tvar remaining = wait - (now - previous);\n\t\t\tcontext = this;\n\t\t\targs = arguments;\n\t\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\t\t\t\tprevious = now;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) context = args = null;\n\t\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t}\n\n\n});\n\nL.eventForwarder = function (options) {\n\treturn new EventForwarder(options);\n};\n\nexport default L.eventForwarder;"],"names":["_options","_container","_prevTarget","EventForwarder","L","Class","extend","initialize","options","enable","document","getElementsByClassName","containerName","events","click","DomEvent","on","map","_handleClick","mousemove","_throttle","_handleMouseMove","throttleMs","throttleOptions","disable","off","event","originalEvent","_stopped","currentTarget","target","stopped","removed","node","pointerEvents","style","nextTarget","elementFromPoint","clientX","clientY","isCanvas","nodeName","toLowerCase","dispatchEvent","MouseEvent","classList","value","indexOf","eventType","ev","stop","type","func","wait","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout","eventForwarder"],"mappings":"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"}